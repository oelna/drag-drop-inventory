<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Inventory</title>
		
		<style>
			* { box-sizing: border-box; }
			html {
				font: 125%/1.25 system-ui, sans-serif;
				font-weight: 500;
				font-style: normal;
			}

			body {
				margin: 0;
				min-height: 100vh;
			}

			#inventory {
				--gap-width: 2px;
				--cell-size: 2rem;

				display: grid;
				grid-template-columns: repeat(6, var(--cell-size));
				grid-template-rows: repeat(5, var(--cell-size));

				width: calc((6 * 2rem) + (7 * var(--gap-width)));
				height: calc((5 * 2rem) + (6 * var(--gap-width)));
				gap: var(--gap-width);
				background: #000;
				border: var(--gap-width) solid #000;
				margin: 2rem auto 0.5rem auto;
			}

			#inventory > * {
				background: #ffe1c9;
			}

			#inventory > .over {
				background: #c74e8e;
			}

			#items {
				--gap-width: 2px;
				--cell-size: 2rem;
				--rows: 1;

				display: grid;
				grid-template-columns: repeat(6, var(--cell-size));
				grid-template-rows: repeat(var(--rows), var(--cell-size));

				width: calc((6 * 2rem) + (7 * var(--gap-width)));
				height: calc((var(--rows) * 2rem) + ((var(--rows) + 1) * var(--gap-width)));
				gap: var(--gap-width);
				background: #000;
				border: var(--gap-width) solid #000;

				margin: 2rem auto 0.5rem auto;
			}

			#items > * {
				background: rgb(204, 230, 238);
			}

			.item {
				background: coral;
				width: 2rem;
				aspect-ratio: 1 / 1;
				cursor: move;
			}

			
		</style>
	</head>
	<body>
		<div id="inventory">
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
		</div>

		<div id="items">
			<div class="cell"><div draggable="true" class="item" id="i1">A</div></div>
			<div class="cell"><div draggable="true" class="item" id="i2">B</div></div>
			<div class="cell"><div draggable="true" class="item" id="i3">C</div></div>
			<div class="cell"></div>
			<div class="cell"></div>
			<div class="cell"></div>
		</div>

		<script>
			let sourceCell = null;

			function handleDragStart(e) {
				this.style.opacity = '0.4';

				dragSrcEl = this;

				if (this.parentNode.classList.contains('cell')) {
					sourceCell = this.parentNode;
				}

				e.dataTransfer.effectAllowed = 'move';
				e.dataTransfer.setData('text/html', this.outerHTML);
			}

			function handleDragEnd(e) {
				this.style.opacity = '1';

				inventoryCells.forEach(function (cell) {
					cell.classList.remove('over');
				});

				sourceCell = null;
			}

			function handleDragOver(e) {
				e.preventDefault();
				return false;
			}

			function handleDragEnter(e) {
				this.classList.add('over');
			}

			function handleDragLeave(e) {
				this.classList.remove('over');
			}

			function handleDrop(e) {
				e.stopPropagation();

				console.log('drop', this, dragSrcEl);

				// handle full cells
				if (this.querySelector('.item')) {
					// cell is full
					console.log('cell is full');

					const sourceItem = dragSrcEl;
					const targetItem = this.querySelector('.item');

					// switch item parents
					sourceCell.append(targetItem);
					this.append(sourceItem);
				} else {
					this.append(dragSrcEl);
					dragSrcEl = null;
				}

				return false;
			}

			const items = document.querySelectorAll('[draggable="true"]');
			items.forEach(function (item) {
				item.addEventListener('dragstart', handleDragStart);
				item.addEventListener('dragend', handleDragEnd);
			});

			const inventoryCells = document.querySelectorAll('.cell');
			inventoryCells.forEach(function (cell) {
				cell.addEventListener('dragover', handleDragOver);
				cell.addEventListener('dragenter', handleDragEnter);
				cell.addEventListener('dragleave', handleDragLeave);
				cell.addEventListener('drop', handleDrop);
			});

		</script>
	</body>
</html>
